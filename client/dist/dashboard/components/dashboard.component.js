"use strict";var __decorate=this&&this.__decorate||function(e,t,o,n){var s,r=arguments.length,i=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(i=(r<3?s(i):r>3?s(t,o,i):s(t,o))||i);return r>3&&i&&Object.defineProperty(t,o,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(o,n){t(o,n,e)}},core_1=require("@angular/core"),common_1=require("@angular/common"),home_component_1=require("../../home/components/home.component"),dashboard_service_1=require("../services/dashboard.service"),user_1=require("../../models/user"),class_list_component_1=require("../../class_list/components/class-list.component"),ng2_bootstrap_1=require("ng2-bootstrap/ng2-bootstrap"),lecturer_auth_component_1=require("./lecturer-auth.component"),question_feed_component_1=require("../../question-feed/components/question-feed.component"),question_input_component_1=require("../../question-input/components/question-input.component"),answer_component_1=require("../../question-feed/components/answer.component"),answer_input_component_1=require("../../question-feed/components/answer-input.component"),DashboardComponent=function(){function e(e,t,o){this._parent=e,this.ref=t,this._dashboardService=o,this.userLoggedIn=!0,this.classes=[],this.user=new user_1.User("",[],[],[],[],"",""),this.questions=[],this.emptyFeed=!1,this.selectedClass=""}return e.prototype.ngOnInit=function(){this.userLoggedIn=this._parent.userLoggedIn,this.initializeUser(JSON.parse(localStorage.getItem("profile")).user_id)},e.prototype.refresh=function(){this.ref.detectChanges()},e.prototype.ngOnDestroy=function(){this.ref.detach()},e.prototype.initializeUser=function(e){firebase.database().ref("users/"+e).on("value",function(t){if(null!=t.val())this.user=this._dashboardService.userFromJSON(t.val()),this.classes=this.user.classes,this.ref.detectChanges();else{var o=new user_1.User(e,[],[],[],[],"","");this.user=o,this._dashboardService.createNewUser(o)}}.bind(this))},e.prototype.checkQuestionInArray=function(e){return e.id==this},e.prototype.classChange=function(e){this.selectedClass=e,firebase.database().ref("classes/"+e+"/questions").on("value",function(e){if(console.log("Dash","class"),null!=e.val()){this.questions=[];for(var t in e.val())firebase.database().ref("questions/"+t).on("value",function(e){console.log("Dash","question");var t=this._dashboardService.questionFromJSON(e.val()),o=this.questions.findIndex(this.checkQuestionInArray,t.id);o>-1&&this.questions.splice(o,1),this.questions.push(t),this.ref.detectChanges()}.bind(this))}}.bind(this))},e.prototype.updateQuestions=function(){},e=__decorate([core_1.Component({selector:"dashboard-cmp",templateUrl:"dashboard/templates/dashboard.html",styleUrls:["dashboard/styles/todo.scss"],providers:[dashboard_service_1.DashboardService],directives:[common_1.CORE_DIRECTIVES,class_list_component_1.ClassListComponent,lecturer_auth_component_1.LecturerAuthComponent,ng2_bootstrap_1.BUTTON_DIRECTIVES,question_feed_component_1.QuestionFeedComponent,answer_component_1.AnswerComponent,question_input_component_1.QuestionInputComponent,answer_input_component_1.AnswerInputComponent]}),__param(0,core_1.Inject(core_1.forwardRef(function(){return home_component_1.HomeComponent}))),__metadata("design:paramtypes",[home_component_1.HomeComponent,core_1.ChangeDetectorRef,dashboard_service_1.DashboardService])],e)}();exports.DashboardComponent=DashboardComponent;